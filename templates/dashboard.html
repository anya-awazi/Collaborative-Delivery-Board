<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Virtual Storage Dashboard</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
    </style>
</head>
<body>
    <h1>Virtual Storage Network Dashboard</h1>
    <h2>Nodes</h2>
    <table id="nodesTable">
        <thead>
            <tr>
                <th>Node ID</th>
                <th>IP</th>
                <th>Alive</th>
                <th>Used Storage</th>
                <th>Total Storage</th>
                <th>Connections</th>
                <th>Active Transfers</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>Network Stats</h2>
    <pre id="networkStats"></pre>

    <script>
        async function updateDashboard() {
            try {
                // Fetch nodes
                let nodesResp = await fetch("/api/nodes");
                let nodes = await nodesResp.json();

                let tbody = document.querySelector("#nodesTable tbody");
                tbody.innerHTML = "";
                nodes.forEach(n => {
                    let tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${n.node_id}</td>
                        <td>${n.ip}</td>
                        <td>${n.alive}</td>
                        <td>${n.storage_used}</td>
                        <td>${n.storage_total}</td>
                        <td>${n.connections.join(", ")}</td>
                        <td>${n.active_transfers}</td>
                    `;
                    tbody.appendChild(tr);
                });

                // Fetch network stats
                let statsResp = await fetch("/api/network_stats");
                let stats = await statsResp.json();
                document.getElementById("networkStats").textContent = JSON.stringify(stats, null, 2);
            } catch (err) {
                console.error(err);
            }
        }

        // Update every 2 seconds
        setInterval(updateDashboard, 2000);
        updateDashboard();
    </script>
</body>
</html>
